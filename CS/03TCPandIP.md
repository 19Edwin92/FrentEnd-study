## 03 TCP and IP 4계층

### TCP/IP 4계층
TCP/IP 프로토콜 스택은 컴퓨터 네트워크에서 데이터 통신을 가능하게 하는 프로토콜의 집합으로 이를 통해서

- 첫째, 인터넷과 네트워크의 작동 원리와 구성 요소에 대한 이해를 얻을 수 있다. (현대 인터넷의 핵심 프로토콜)
- 둘쨰, 이를 통해 네트워크 관리자나 시스템 관리자가 문제를 진단하고 해결하는 데 도움이 된다. 
- 셋째, 이를 이해하는 것은 네트워크 프로그래밍의 필수이다. 클라이언트-서버 모델의 통신이 이를 기반으로 구성되기 떄문이다. 
- 넷째, 이는 또한 보안과 관련하여, 네트워크 보안 위협을 감지하고 방지하는데 도움을 준다. 

1. TCP/IP 프로토콜 스택

      - (1) 데이터는 응용계층에서 생성되며, 사용자 애플리케이션에 의해 생성된 데이터를 전송 계층으로 전달합니다. 
      - (2) 전송계층은 클라이언트와 서버 간의 통신을 관리하고 데이터의 신뢰성과 흐름 제어를 담당한다. 클라이언트에서 생성된 데이터는, 전승계층을 통해 서버로 전송된다. 이 과정에서 네트워크 간의 연결을 설정한 후에 전송한다. 
      - (3) 인터넷 계층과 네트워크 계층은 택배로 비유하면, 마치 송장에 기록되는 출발지와 목적지 부분이 인터넷 계층에 해당된다. 인터넷 계층은 출발지에서 목적지로 전달되기 위한 경로를 설정하고 목적지 주소를 확인하는 역할을 한다. 
      - (4) 네트워크 인터페이스 계층은 송장에 기록된 주소에 따라 실제로 물건을 전달하는 배달을 수행한다. 실제로 데이터가 물리적인 전송 매체인 배달차량, 택배 상자 등을 통해 목적지로 전송되듯 이더넷과 WiFi를 통해 목적지로 데이터를 전달한다. 

  - 응용계층(Application Layer)

      > 응용계층은 사용자가 인터넷 서비스에 접근하고 데이터를 주고받을 수 있도록 네트워크 간의 통신을 담당한다. 
      > 이 계층에서는 특정한 응용 프로토콜이 동작하며,데이터의 형식, 규칙, 암호와 등을 정의한다. 
      > - 예) HTTP, FTP, SMTP, DNS 등이 응용 계층에서 사용되는 프로토콜이다. 

      <br/>

    <details>    
    <summary>응용계층과 프로토콜</summary><br />

      1. HTTP (Hypertext Transfer Protocol) : `하이퍼텍스트 문서`를 전송하기 위한 프로토콜도, 클라이언트와 서버 간에 요청(Request)과 응답(Response)의 형태로 데이터(HTML, 이미지, 동영상)를 주고받는다. HTTP는 상태를 유지하지 않는 Stateless 프로토콜로, 각 요청은 독립적으로 처리된다. 

          - `HTTP/1.0` : 초기 보전으로, 단일 요청과 응답 후 연결을 닫는 형태로 동작한다. 오버헤드가 크고 성능이 낮은 단점이 있다. 
          - `HTTP/1.1` : Keep-alive을 통해 여러요청을 단일 연결로 처리하고, 성능이 향상되고, 파이프라인화와 청크 전송이 추가되었다.
          - `HTTP/2.0` : 성능과 보안을 개선하기 위해 설계된 버전으로, 단일 연결에서 다중 요청-응답 지원(헤더압축, 서버푸시,스트림) 
          - `HTTP/3.0` : 전송계층으로 TCP 대신 QUIC 프로토콜(UDP 기반)을 사용하는 버전, 빠른연결설정, 안정적인전송
          - `HTTPs` : HTTP 프로토콜을 암호화하기 위해 사용되는 보안 프로토콜로, 데이터의 기밀성과 무결성을 보호한다. 
          <br/><br/>

      2. FTP (File Transfer Protocol) : `파일 전송을 위한 프로토콜`로 파일 업로드, 다운로드, 디렉토리 검색, 파일 삭제 등 다양한 파일 조작 기능을 제공한다. FTP는 인증과 암호화를 지원하여 보안적인 파일 전송을 지원한다. 

      3. SMTP (Simple Mail Transfer Protocol) : `전자 메일 전송을 위한 프로토콜`로, 이메일의 전송과 동시에 메일 서버 간에 인증과 메일의 검증, 중복 제거 등을 수행한다. 

      4. DNS (Domain Name System) : 도메인 이름과 IP 주소 간의 매핑을 관리하는 시스템 및 프로토콜로, 사람이 이해하기 쉬운 도메인 이름을 컴퓨터가 이해할 수 있는 IP 주소로 변환한다. 

    </details><br/>

  - 전송계층(Transport Layer)

      > 전송계층은 종단 간 데이터 전송을 관리하며, TCP와 UDP와 같은 프로토콜이 동작한다. 
      > 전송 계층은 응용 계층에서 받은 데이터를 세그먼트로 분할하고, 목적지까지 데이터의 신뢰성과 흐름 제어를 담당한다. 

    <details>    
    <summary>전송계층과 프로토콜</summary><br />

      1. TCP (Transmission Control Protocol) : 신뢰성 있는 연결 지향 데이터 전송을 제공하며, 패킷 손실을 검출하고 재전송하는 기능

          > 간단히 말해서, `TCP는 근거리 통신망이나 인트라넷, 인터넷에 연결된 컴퓨터에서 실행되는` 프로그램 간에 일련의 옥텟(8비트)을 안정적으로, 순서대로, 에러없이 교환할 수 있도록 하는 `규약`이다. 

          - 이 과정에서 2개의 호스트(클라이언트, 서버)를 연결하게 되는데, 이를 `3-way handshaking`이라 한다. 패킷을 통해 서로의 정보를 확인하는 과정으로, 3-way handshake 과정에서 SYN/ACK 패킷이 제대로 전달되지 않거나, 패킷이 손실되어 재전송이 필요한 경우에는 연결이 설정되지 않아 데이터 전송이 이루어지지 않게 되며, 이 경우에는 오류 메시지가 발생하거나 연결 시간이 초과되어 timeout이 발생할 수 있다. 

          - `3-way handshake` : 연결설정

              먼저, 클라이언트가 서버에게 연결을 요청하는 과정으로, SYN(Synchronize) 패킷을 보낸다. 

              둘쨰, 서버는 SYN 패킷을 받고, SYN/ACK(Acknowledge) 패킷을 클라이언트로 보낸다. 이 패킷은 서버가 클라이언트의 요청을 수락하고, 자신의 초기 순차 번호를 선송하는 역할을 한다. 

              셋째, 클라이언트는 SYN/ACK 패킷을 받고, ACK(Acknowledge) 패킷을 서버로 보낸다. 이 패킷은 클라이언트가 서버의 응답을 받았음을 확인하는 역할을 수행한다. 

              이 과정이 완료되면, 클라이언트와 서버 간의 TCP 연결이 설정된다. 

          - `4-way handshake` : 연결해제

              - 종료를 알리고자 하는 측 >> FIN 패킷
              - 전달받은 측 >> ACK를 보내어 더 이상 데이터를 보내지 않을 것을 알림
              - 종료를 알리고자 하는 측 >> 모든 데이터와 함께 더 이상 데이터를 받지 않을 것을 알리는 FIN 패킷을 전달
              - 전달받은 측 >> ACK를 보냄으로 연결을 종료한다. 
              <br/><br/>

              클라이언트 또는 서버가 연결을 종료하고 연결을 해제하는 과정이다. (1) 클라이언트 또는 서버는 상대방에게 연결을 종료하고자 하는 의도를 알리기 위해 FIN(Finish) 패킷을 보내고, (2) 상대방은 해당 패킷을 받은 뒤 ACK 패킷을 전송하여, 더 이상 데이터를 보내지 않을 것임을 알린다. 

              (3) ACK 패킷을 전달받은 후, 연결을 종료하는 측은 모든 데이터를 보내고, 더 이상 데이터를 받지 않는 후에 마지막으로 FIN 패킷을 전송한다. (4) 이를 받은 상대방은 ACK 패킷을 보내면서 연결을 완전히 종료한다. 


      2. UDP (User Datagram Protocol) : 비연결성 프로토콜로, 데이터를 신속하게 전송하지만 신뢰성은 보장하지 않는다. 

          > ‘사용자 데이터그램 프로토콜’은 TCP와 함께 데이터그램으로 알려진 단문 메시지를 교환하기 위해서 사용된다. UDP의 전송 방식은 너무 단순해서 서비스의 신뢰성이 낮고, 데이터그램 도착 순서가 바뀌거나, 중복되거나, 심지어는 통보 없이 누락시키기도 한다.

          - 대표적으로 
            > UDP는 전송 속도가 빠르고 오버헤드가 적은 통신에서 활용된다. DNS(Domain Name System)은 도메인의 이름을 IP주소로 변환해 주는데, 클라이언트가 DNS서버에게 질의 메시지를 보내면, DNS서버는 UDP 패킷을 사용하여 클라이언트에게 응답을 보낸다. 

            > 비디오/오디오 스트리밍은 매우 큰 데이터 양을 빠르게 전송해야 하기 때문에 UDP프로토콜을 사용하여 동작한다. TCP는 전송할 데이터를 나누어 여러 번 전송하고, 순차적으로 보내는데, 지연이 발생될 수 있다. 그러기에 UDP를 사용하여 데이터를 한번에 보내고, 전송이 실패하면 다시 전송하는 방식으로 동작하며, 전송 속도가 빠르고 지연이 적은 비디오.오디오 스트리밍 서비스를 제공하는 것이다.

    </details><br/>  

  - 인터넷계층(Internet Layer)

      > 인터넷 계층은 전송 계층으로부터 받은 세그먼트(데이터)를 패킷이라는 작은 단위로 나누고, 패킷은 목적 IP 주소와 출발지 IP 주소를 포함하여, 데이터와 함께 네트워크 인터페이스 계층으로 전달될 준비가 된다. 즉 인터넷 계층은 패킷을 라우팅하여 목적지까지 안전하고 정확하게 전달하는 역할로, IP는 인터넷 계층에서 주로 사용되는 프로토콜이다. 

      > 쉽게 설명해서 "자료를 위한 네비게이션 경로 설정"으로 단순하게 설명될 수 있는데, GPT 선생은 큰 그림에서 맞는 표현이라고 평가해주었다. 

  - 네트워크 인터페이스 계층(Network Interface Layer)

    > 네트워크 인터페이스 계층은 네트워트와 물리적인 연결과 데이터 전송을 관리하는데, 
    > 데이터를 패킷 형태로 받아 하드웨어로 전송하거나, 하드웨어로부터 패킷을 수신하여 데이터로 변환합니다. 

    > 네트워크 계층은 데이터를 물리적인 전송 매체인 이더넷, WI-FI, PPP 등을 통해 전송한다. 
    > 인터넷계층에서 확인된 경로로, 네트워크 계층은 물리적인 데이터를 전송하며, 데이터를 안정하고 정확하게 목적지까지 전달한다. 

    <details>    
    <summary>네트워크 인터페이스의 물리적인 전송 매체</summary><br />

      1. Wi-Fi (Wireless Fidelity) : 무선 통신 기술로, 컴퓨터나 모바일 기기 등 무선 네트워크에 연결하여 데이터를 전송하는 통로이다.
      2. 이더넷 (Ethernet) : 이더넷은 유선 통신 기술로, 이더넷 케이블을 사용하여 컴퓨터, 라우터, 스위치 등의 장치 간에 데이터를 전송하는데 사용한다. 주로 LAN(Local Area Network) 환경에서 네트워크 연결을 제공한다. 이더넷은 유선 케이블을 사용하여 안전적이고 빠른 데이터 전송을 제공한다. 
    </details><br/>          


